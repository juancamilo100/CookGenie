<html>
    <head>
        <title>SimbleeCloud Light Demo</title>
        <style>
            body {
                text-align: center;
                background-color: #ddd;
            }

            #dialog {
                position: absolute;
                left: 50%;
                right: 50%;
                top: 50%;
                bottom: 50%;
                height: 550px;
                width: 450px;
                margin-left: -225px;
                margin-top: -275px;
                border: 1px solid #888;
                border-radius: 5px;
                background-color: #ededed;
                box-shadow: 0px 2px 5px #666;
            }

            h1 {
                font-family: Helvetica, Verdana, sans-serif;
            }

            h3 {
                font-family: Helvetica, Verdana, sans-serif;
                color: #2a2a2a;
            }

            span.connected {
                color: green;
            }

            span.disconnected {
                color: red;
            }

            img {
                width: 150px;
                height: 255px;
                background-size: contain;
                border-style: none;
            }

            #button {
                display: inline-block;
                width: 100px;
                height: 60px;
                border: 1px solid #aaa;
                border-radius: 3px;
                background-color: #eee;
                margin-top: 30px;
                cursor: pointer;
            }

            #button:hover {
                background-color: #ddd;
            }

            #button:active {
                background-color: #ccc;
            }

            #button span {
                font-size: 15px;
                line-height: 60px;
                font-family: Helvetica, Verdana, sans-serif;
                color: green;
            }

            #button span.on {
                color: red;
            }
        </style>
    </head>
    <body>
        <div id="dialog">
            <h1>Light Cloud Demo</h1>
            <h3>Cloud Status: <span id="cloud_status" class="disconnected">Disconnected</span></h3>
            <h3>Light Status: <span id="lamp_status" class="disconnected">Disconnected</span></h3>
            <img id="light" src="light_off.png" />
            <br>
            <div id="button">
                <span id="button_text">Turn On</span>
            </div>
        </div>
        <script type="text/javascript" src="SimbleeCloud.js"></script>
        <script type="text/javascript">
            var cloudStatus = document.getElementById("cloud_status");
            var lightStatus = document.getElementById("lamp_status");
            var lightImage = document.getElementById("light");
            var button = document.getElementById("button");
            var buttonText = document.getElementById("button_text");
            var cloud = new SimbleeCloud();
            var destESN = 0x147ff8c6; // enter your destination ESN here
            cloud.myESN = 0x00001010; // enter your pool ESN here
            cloud.userID = 0x1bd8421d; // enter your user id here
            cloud.connect();

            var lightDisconnected = setInterval(function() {
                lightStatus.className = "disconnected";
                lightStatus.innerHTML = "Disconnected";
            }, 2000);

            setInterval(function() {
                var payload = new ArrayBuffer(1);
                var view = new DataView(payload);
                view.setUint8(0, "2".charCodeAt(0));
                cloud.send(destESN, payload);
            }, 1000);

            cloud.onactive = function() {
                cloudStatus.className = "connected";
                cloudStatus.innerHTML = "Connected";
                var payload = new ArrayBuffer(1);
                var view = new DataView(payload);
                view.setUint8(0, "2".charCodeAt(0));
                cloud.send(destESN, payload);
            };

            cloud.oninactive = function() {
                cloudStatus.className = "disconnected";
                cloudStatus.innerHTML = "Disconnected";
            };

            cloud.onrequest = function(originESN, payload) {
                window.clearInterval(lightDisconnected);
                lightDisconnected = setInterval(function() {
                    lightStatus.className = "disconnected";
                    lightStatus.innerHTML = "Disconnected";
                }, 1500);
                var view = new DataView(payload);
                var data = String.fromCharCode(view.getUint8(0));
                lightStatus.className = "connected";
                lightStatus.innerHTML = "Connected";

                if (data == '1') {
                    lightImage.src = "light_on.png";
                    buttonText.className = 'on';
                    buttonText.innerHTML = "Turn Off";
                } else if (data == '0') {
                    lightImage.src = "light_off.png";
                    buttonText.className = '';
                    buttonText.innerHTML = "Turn On";
                }
            };

            button.onclick = function() {
                var payload = new ArrayBuffer(1);
                var view = new DataView(payload);

                if (buttonText.classList.length == 0) {
                    view.setUint8(0, "1".charCodeAt(0));
                    cloud.send(destESN, payload);
                } else if (buttonText.className == 'on') {
                    view.setUint8(0, "0".charCodeAt(0));
                    cloud.send(destESN, payload);
                }
            };
        </script>
    </body>
</html>